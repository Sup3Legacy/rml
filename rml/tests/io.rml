let process p {in s1; out s2} =
  loop
    present s1 then (emit s2; pause)
  end

let process read_status name {out s} =
  loop
    print_string ("Entrez le status de "^name^" (0/1) :");
    match read_int() with
    | 0 -> pause
    | 1 -> emit s; pause
    | _ -> failwith "I/O err"
  end

let process write_status name {in s} =
  loop
    present s then 
      (pause;
       print_string (name^" etait present a l'instant precedant"))
    else
      print_string (name^" etait absent a l'instant precedant");
    print_newline()
  end

let process main {} =
  signal s1, s2 in
  run (write_status "s2") {s=s2} 
  ||
  run (read_status "s1") {s=s1}
  ||
  run p {s1=s1; s2=s2}

