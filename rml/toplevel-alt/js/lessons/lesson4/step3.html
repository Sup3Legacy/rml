<p>
Finally, the source code of the alarm clock is the following:
</p>

<p><pre class="code">
let process alarm off arm snooze = 
  let rec process idle = 
    do
      halt
    until 
    | arm -> 
	print_endline "Armed!";
	run (armed 1000) 
    done

  and process armed d = 
    signal bip in
    do 
      run (sleep d);
      emit bip;
      pause
    until 
    | off -> 
	print_endline "Off!";
	run idle
    | bip -> 
	run bipbipbip
    done

  and process bipbipbip = 
    do 
      loop
	print_endline "Bip, Bip, Bip!!!";
	pause
      end
    until 
    | snooze  -> 
	print_endline "Snooze!";
	run (armed 200)
    | off ->
    	print_endline "Off!";
    	run idle
    done
  in
run idle
</pre></p>
