<p>
Again, the automata is implemented using three mutually recursive processes.
</p>

<p><pre class="code">
let alarm ck_off ck_bip ck_snooze ck_arm = 

  let rec process idle = 
    do
      halt
    until ck_arm (d) -> 
	print_endline "Armed!";
	run (armed d) 
    done

  and process armed d = 
    do 
      run (sleep d);
      emit ck_bip; pause
    until 
    | ck_off -> 
	print_endline "Off!";
	run idle
    | ck_bip -> 
	run bipbipbip
    done

  and process bipbipbip = 
    do 
      loop
	print_endline "Bip, Bip, Bip!!!";
	pause
      end
    until 
    | ck_snooze  -> 
	print_endline "Snooze!";
	run (armed 200)
    | ck_off ->
    	print_endline "Off!";
    	run idle
    done

  in idle;;
</pre></p>
